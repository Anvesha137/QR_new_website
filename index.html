<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quickrevert Website Design</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <style>
      /* Custom styles for n8n chat widget */
      #n8n-chat-button {
        font-family: 'Montserrat', sans-serif !important;
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
        border: none;
        border-radius: 50px;
        padding: 12px 24px;
        background: linear-gradient(135deg, #6366f1 0%, #818cf8 100%);
        color: white;
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s ease;
      }
      
      #n8n-chat-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(99, 102, 241, 0.4);
      }
      
      #n8n-chat-button:active {
        transform: translateY(0);
      }
      
      /* Custom chat container styling */
      #n8n-chat-container {
        position: fixed;
        bottom: 80px;
        right: 20px;
        width: 380px;
        height: 500px;
        z-index: 1000;
        font-family: 'Montserrat', sans-serif !important;
        display: none;
      }
      
      #n8n-chat-container.active {
        display: block;
      }
      
      /* Chat window styling */
      #n8n-chat {
        background: white;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        height: 100%;
        display: flex;
        flex-direction: column;
        border: 1px solid #e2e8f0;
      }
      
      /* Chat header */
      .n8n-chat-header {
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        color: white;
        padding: 16px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }
      
      .n8n-chat-header__title {
        font-family: 'Montserrat', sans-serif !important;
        font-weight: 600;
        font-size: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      .n8n-chat-header__close {
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        font-size: 20px;
        padding: 0;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: background 0.2s;
      }
      
      .n8n-chat-header__close:hover {
        background: rgba(255, 255, 255, 0.1);
      }
      
      /* Chat messages container */
      .n8n-chat-messages {
        flex: 1;
        padding: 16px;
        overflow-y: auto;
        background: #f8fafc;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      
      /* Chat message styling */
      .n8n-chat-message {
        display: flex;
        gap: 12px;
        max-width: 85%;
      }
      
      .n8n-chat-message--user {
        align-self: flex-end;
      }
      
      .n8n-chat-message__avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 14px;
      }
      
      .n8n-chat-message--bot .n8n-chat-message__avatar {
        background: linear-gradient(135deg, #6366f1 0%, #818cf8 100%);
        color: white;
      }
      
      .n8n-chat-message--user .n8n-chat-message__avatar {
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        color: white;
      }
      
      .n8n-chat-message__content {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      
      .n8n-chat-message__bubble {
        padding: 12px 16px;
        border-radius: 18px;
        font-family: 'Montserrat', sans-serif !important;
        font-size: 14px;
        line-height: 1.4;
        position: relative;
      }
      
      .n8n-chat-message--bot .n8n-chat-message__bubble {
        background: white;
        color: #334155;
        border: 1px solid #e2e8f0;
        border-top-left-radius: 4px;
      }
      
      .n8n-chat-message--user .n8n-chat-message__bubble {
        background: linear-gradient(135deg, #6366f1 0%, #818cf8 100%);
        color: white;
        border-bottom-right-radius: 4px;
      }
      
      .n8n-chat-message__timestamp {
        font-family: 'Montserrat', sans-serif !important;
        font-size: 10px;
        color: #94a3b8;
        margin-top: 2px;
      }
      
      .n8n-chat-message--user .n8n-chat-message__timestamp {
        color: #c7d2fe;
        text-align: right;
      }
      
      /* Chat input styling */
      .n8n-chat-input {
        padding: 16px;
        background: white;
        border-top: 1px solid #e2e8f0;
        display: flex;
        gap: 8px;
      }
      
      .n8n-chat-input__field {
        flex: 1;
        padding: 12px 16px;
        border: 1px solid #e2e8f0;
        border-radius: 24px;
        font-family: 'Montserrat', sans-serif !important;
        font-size: 14px;
        outline: none;
        transition: border-color 0.2s;
      }
      
      .n8n-chat-input__field:focus {
        border-color: #6366f1;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      }
      
      .n8n-chat-input__button {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, #6366f1 0%, #818cf8 100%);
        border: none;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: transform 0.2s;
      }
      
      .n8n-chat-input__button:hover {
        transform: scale(1.05);
      }
      
      .n8n-chat-input__button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }
      
      /* Welcome message styling */
      .n8n-chat-welcome {
        text-align: center;
        padding: 24px 16px;
        background: white;
        border-radius: 12px;
        margin-bottom: 16px;
        border: 1px solid #e2e8f0;
      }
      
      .n8n-chat-welcome__title {
        font-family: 'Montserrat', sans-serif !important;
        font-weight: 600;
        font-size: 18px;
        color: #0f172a;
        margin-bottom: 8px;
      }
      
      .n8n-chat-welcome__message {
        font-family: 'Montserrat', sans-serif !important;
        font-size: 14px;
        color: #64748b;
        line-height: 1.5;
        margin-bottom: 16px;
      }
      
      /* Loading indicator */
      .n8n-chat-loading {
        display: inline-block;
        width: 24px;
        height: 24px;
        border: 3px solid rgba(99, 102, 241, 0.3);
        border-radius: 50%;
        border-top-color: #6366f1;
        animation: spin 1s ease-in-out infinite;
      }
      
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      
      /* Scrollbar styling */
      .n8n-chat-messages::-webkit-scrollbar {
        width: 6px;
      }
      
      .n8n-chat-messages::-webkit-scrollbar-track {
        background: #f1f5f9;
      }
      
      .n8n-chat-messages::-webkit-scrollbar-thumb {
        background: #c7d2fe;
        border-radius: 3px;
      }
      
      .n8n-chat-messages::-webkit-scrollbar-thumb:hover {
        background: #6366f1;
      }
    </style>
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    <script type="module">
      // Custom chat implementation with n8n webhook
      document.addEventListener('DOMContentLoaded', function() {
        // Create chat button
        const chatButton = document.createElement('button');
        chatButton.id = 'n8n-chat-button';
        chatButton.innerHTML = `
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
          </svg>
          Chat with us
        `;
        document.body.appendChild(chatButton);
        
        // Create chat container
        const chatContainer = document.createElement('div');
        chatContainer.id = 'n8n-chat-container';
        chatContainer.innerHTML = `
          <div id="n8n-chat">
            <div class="n8n-chat-header">
              <div class="n8n-chat-header__title">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                </svg>
                Quickrevert Assistant
              </div>
              <button class="n8n-chat-header__close">&times;</button>
            </div>
            <div class="n8n-chat-messages">
              <div class="n8n-chat-welcome">
                <h3 class="n8n-chat-welcome__title">Welcome to Quickrevert!</h3>
                <p class="n8n-chat-welcome__message">I'm your AI assistant ready to help you with any questions about our chatbot solutions.</p>
              </div>
            </div>
            <div class="n8n-chat-input">
              <input type="text" class="n8n-chat-input__field" placeholder="Type your message here..." />
              <button class="n8n-chat-input__button">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="22" y1="2" x2="11" y2="13"></line>
                  <polygon points="22,2 15,22 11,13 2,9 22,2"></polygon>
                </svg>
              </button>
            </div>
          </div>
        `;
        document.body.appendChild(chatContainer);
        
        // Chat functionality
        const toggleChat = () => {
          chatContainer.classList.toggle('active');
        };
        
        const closeChat = () => {
          chatContainer.classList.remove('active');
        };
        
        chatButton.addEventListener('click', toggleChat);
        document.querySelector('.n8n-chat-header__close').addEventListener('click', closeChat);
        
        // Handle sending messages to n8n webhook
        const inputField = document.querySelector('.n8n-chat-input__field');
        const sendButton = document.querySelector('.n8n-chat-input__button');
        const messagesContainer = document.querySelector('.n8n-chat-messages');
        
        // Function to send message to n8n webhook
        const sendToWebhook = async (message, isInitial = false) => {
          // Show typing indicator
          const typingIndicator = document.createElement('div');
          typingIndicator.className = 'n8n-chat-message n8n-chat-message--bot';
          typingIndicator.id = 'typing-indicator';
          typingIndicator.innerHTML = `
            <div class="n8n-chat-message__avatar">Q</div>
            <div class="n8n-chat-message__content">
              <div class="n8n-chat-message__bubble">
                <div class="n8n-chat-loading"></div>
              </div>
            </div>
          `;
          messagesContainer.appendChild(typingIndicator);
          messagesContainer.scrollTop = messagesContainer.scrollHeight;
          
          try {
            // Send message to n8n webhook
            const response = await fetch('https://n8n.quickrevert.tech/webhook/352ceda6-f461-4238-8ed3-698ea8d20330', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                message: message,
                timestamp: new Date().toISOString()
              })
            });
            
            // Remove typing indicator
            typingIndicator.remove();
            
            let responseText = '';
            
            if (!response.ok) {
              // If response is not OK, try to get error message
              try {
                const errorData = await response.json();
                responseText = errorData.message || errorData.error || `HTTP error! status: ${response.status}`;
              } catch (e) {
                responseText = `HTTP error! status: ${response.status}`;
              }
            } else {
              // Try to parse response as JSON
              try {
                const data = await response.json();
                
                // Extract and display only the output field from n8n response
                if (typeof data === 'string') {
                  responseText = data;
                } else if (data && typeof data === 'object' && data.output) {
                  responseText = data.output;
                } else {
                  // If no output field, display the full response as string
                  responseText = JSON.stringify(data, null, 2);
                }
              } catch (e) {
                // If not JSON, get as text
                responseText = await response.text();
              }
            }
            
            // Add bot response
            const botMessage = document.createElement('div');
            botMessage.className = 'n8n-chat-message n8n-chat-message--bot';
            botMessage.innerHTML = `
              <div class="n8n-chat-message__avatar">Q</div>
              <div class="n8n-chat-message__content">
                <div class="n8n-chat-message__bubble">
                  ${responseText}
                </div>
                <div class="n8n-chat-message__timestamp">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
              </div>
            `;
            messagesContainer.appendChild(botMessage);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
          } catch (error) {
            console.error('Error sending message to n8n:', error);
            
            // Remove typing indicator
            typingIndicator.remove();
            
            // Show error message only if it's not the initial message
            if (!isInitial) {
              const errorMessage = document.createElement('div');
              errorMessage.className = 'n8n-chat-message n8n-chat-message--bot';
              errorMessage.innerHTML = `
                <div class="n8n-chat-message__avatar">Q</div>
                <div class="n8n-chat-message__content">
                  <div class="n8n-chat-message__bubble">
                    Sorry, I encountered an error processing your request. Please try again.
                  </div>
                  <div class="n8n-chat-message__timestamp">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                </div>
              `;
              messagesContainer.appendChild(errorMessage);
              messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
          }
        };
        
        // Send initial message when chat opens
        const sendInitialMessage = () => {
          // Send trigger message to webhook without showing error
          sendToWebhook("Chat started", true);
        };
        
        const sendMessage = async () => {
          const message = inputField.value.trim();
          if (!message) return;
          
          // Add user message
          const userMessage = document.createElement('div');
          userMessage.className = 'n8n-chat-message n8n-chat-message--user';
          userMessage.innerHTML = `
            <div class="n8n-chat-message__avatar">U</div>
            <div class="n8n-chat-message__content">
              <div class="n8n-chat-message__bubble">
                ${message}
              </div>
              <div class="n8n-chat-message__timestamp">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
            </div>
          `;
          messagesContainer.appendChild(userMessage);
          
          // Clear input
          inputField.value = '';
          
          // Scroll to bottom
          messagesContainer.scrollTop = messagesContainer.scrollHeight;
          
          // Send to webhook
          sendToWebhook(message);
        };
        
        sendButton.addEventListener('click', sendMessage);
        
        inputField.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            sendMessage();
          }
        });
        
        // Automatically open chat on page load and send initial message
        chatContainer.classList.add('active');
        setTimeout(sendInitialMessage, 500);
      });
    </script>
  </body>
</html>